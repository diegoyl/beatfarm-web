window.parseRawRhythm = (raw, pitched) => {
    // raw = 'xx.x..xx..x..xx.'
    // rawPitched = [ 'A', '' , '' ,'' , 'G' , , , ]
    // parsed = [1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0] 
    let raw_rhythm = new Array(loopLength).fill('.'); // Example array with 16 elements

    if (pitched) { // synth or bass track
        for (let i=0; i < loopLength; i++) {
            if (raw[i] != '') {
                raw_rhythm[i] = 'x'
            }
        }
    } else {
        raw_rhythm = raw.slice(0)
    }


    let rhythm_arr = new Array(loopLength).fill(0); // Example array with 16 elements

    for (let i=0; i < loopLength; i++) {
        if (raw_rhythm[i] == 'x') {
            rhythm_arr[i] = 1
        }
    }

    return rhythm_arr
}

window.parseRawPitches = (raw, track) => {
    // rawPitched = [ 'A', '' , '' ,'' , 'G' , , , ]
    // parsed = [ .5, false, .44, false, .53, .88, false, .91 ]

    let pitch_rates = new Array(loopLength).fill(0); // Example array with 16 elements



    for (let i=0; i < loopLength; i++) {
        if (raw[i] != '') {
            pitch_rates[i] = note2rate(raw[i])
        }
    }
    return pitch_rates
}


function transpose(og_pitches, shift) { 
    console.log('\n\nTRANSPOSING')
    let new_pitches = new Array(og_pitches.length).fill(''); // Example array with 16 elements

    for (let i=0; i < og_pitches.length; i++) {
        if (og_pitches[i] != '') {
            
            let new_idx = note2shift[og_pitches[i]] + shift
            let new_note = ''
            for (const [note_name, note_shift] of Object.entries(note2shift)) {
                if (note_shift === new_idx) {
                    new_note = note_name; // Return the first found player
                    break;
                }
            }

            new_pitches[i] = new_note
        }
    }

    let print_string = "["
    for (let i=0; i < new_pitches.length; i++) {
        print_string += "'" + new_pitches[i] + "',"
    }
    print_string = print_string.slice(0, -1) + "],"
    console.log(print_string)

}

const note2shift = {
    'C' :  0,
    'C#' : 1,
    'Db' : 1,
    'D' :  2,
    'D#' : 3,
    'Eb' : 3,
    'E' :  4,
    'F' :  5,
    'F#' : 6,
    'Gb' : 6,
    'G' :  7,
    'G#' : 8,
    'Ab' : 8,
    'A' :  9,
    'A#' : 10,
    'Bb' : 10,
    'B' :  11,

    'c' :  12, // BASE SAMPLE
    'c#' : 13,
    'db' : 13,
    'd' :  14,
    'd#' : 15,
    'eb' : 15,
    'e' :  16,
    'f' :  17,
    'f#' : 18,
    'gb' : 18,
    'g' :  19,
    'g#' : 20,
    'ab' : 20,
    'a' :  21,
    'a#' : 22,
    'bb' : 22,
    'b' :  23,

}

function note2rate(note_name) {
    let shift_index = note2shift[note_name]
    let rate = 0.5 * 2**( shift_index / 12 )

    return rate
}

window.PATTERNLIB = {
    
    'kick':{
        'boombap': [
            'x.......x.x.....x.......x.x.....',
            'x......xx.x...x.x......xx.x.....',
            'x..x...xx.x...x.x......xx.x...x.',
            'x..x...xx.x..x..x..x...xx.x..x..'
        ],
        'westcoast': [
            'x.........x..x..x.........x..x..',
            'x..x..x...x..x..x..x..x...x..x..',
            'x..x..x.x.....x.x..x..x.xx....x.',
            'x..x..x.xx....xxx..x..x.xx....xx'
        ],
        'trap': [
            'x.....x...x.....x.....x...x.....',
            'x..x......x..x..x..x......x..x..',
            'x..x..xx..x..x..x..x..xx..x..x..',
            'xx.x..xx..x..xx.xx.x..xx..x..xx.'
        ],
        'neptunes': [
            'x.........x..x..x.........x..x..',
            'x.....xx..x.....x.....xx..x.....',
            'x.....xxxxx..x..x.....xxxxx..x..',
            'x.x..x.x.x.x....x.x..x.x.x.x....'
        ],
    },
    
    
    
    'snare':{
        'boombap': [
            '....x.......x.......x.......x...',
            '....x.......x..x....x.......x..x',
            '....x....x..x.......x....x..x...',
            '....x....x..x..x....x....x..x..x'
        ],
        'westcoast': [
            '....x.......x.......x.......x...',
            '....x.......x.......x.......x...',
            '....x..x....x.......x..x....x...',
            '....x..x....x.x.....x..x....x.x.'
        ],
        'trap': [
            '....x.......x.......x.......x...',
            '....x..x....x.......x....x..x...',
            '....x....x..x..x....x..x.x..x..x',
            '.x..x..x.x..xx.x.x..x..x.x..x.xx'
        ],
        'neptunes': [
            '....x.......x.......x.......x...',
            '....x.......x.x.....x.......x.x.',
            '....x.......x..x....x.......x..x',
            '....x..x....x.x.....x..x....x.x.'
        ],
    },
    
    
    
    'hihat':{
        'boombap': [
            'x...x...x...x...x...x...x...x...',
            'x.x...x...x...x.x.x...x...x...x.',
            'x.x.x.x.x.x.x.x.x.x.x.x.x.x.x.x.',
            'x.xxx.x.x.x.xxx.x.xxx.x.x.x.xxx.'
        ],
        'westcoast': [
            '..x...x...x...x...x...x...x...x.',
            '..x...x.xx....x...x...x.xx....x.',
            'x..x..x...xx....x..x..x...xx....',
            'xxxx..xx..xx..x.xxxx..xx..xx..x.'
        ],
        'trap': [
            'x.x.x.x.x.xxxxxxx.x.x.x.x.xxxxxx',
            'xxxxx.x.x.xxx.xxxxxxx.x.x.xxx.xx',
            'xxxxx.xxxxxxx.xxxxxxx.xxxxxxx.xx',
            'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'
        ],
        'neptunes': [
            '..xx..xx..xx..xx..xx..xx..xx..xx',
            'xxxxx.x.x.x.x.x.xxxxx.x.x.x.x.x.',
            'x.x.......x..xx.x.x.......x..xx.',
            'x.xxx.x.x.x.x.x.x.xxx.x.x.x.x.x.'            
        ],
    },
    
    
    
    
    'bass':{
        'boombap': [
            ['A','','','','','','','','c','','','','','','','','A','','','','','','','','c','','','','','','',''],
            ['A','','','','c#','','','','c','','','','e','','','','A','','','','c#','','','','c','','','','e','','',''],
            ['A','','','','c#','','A','','c','','f','','e','','','','A','','d','','c#','','','','c','','','','e','','g',''],
            ['A','','d','','c#','','A','','c','','f','','e','','','','A','','d','','c#','','A','','c','','f','','e','','g',''],
        ],
        'westcoast': [
            ['D#','','','','','','','','','','','','','','','','B','','','','','','','','','','','','','','','',],
            ['D#','','','','','','','','','','Bb','','','','','','B','','','','','','','','','','Bb','','','','','',],
            ['D#','','','','','','Bb','','','','Bb','','','Bb','','','B','','','','','','','','','','Bb','','','Bb','Bb','',],
            ['D#','','','D#','','','Bb','','','','Bb','','','Bb','','','B','','','','','B','B','','','','Bb','','','Bb','Bb','',],
        ],
        'trap': [
            ['Bb','','','','','','B','','','','','','','','','','Ab','','','','','Eb','','','','','','','','',''],
            ['Bb','','','','','','B','','','','B','','','Ab','','','Ab','','','','','','Eb','','','','','','Eb','','',''],
            ['Bb','','','','','','B','','','','B','','','Ab','','','Ab','','','','','','Eb','','','','eb','','Eb','','',''],
            ['Bb','','','Bb','','','B','','','','B','','Ab','Ab','','','Ab','','','','','','Eb','','','','eb','','Eb','','Eb','Eb'],
        ],
        'neptunes': [
            ['B','','G#','','G#','','F#','','E','C#','','','','','','','C#','','','','','','','C#','','','','','','','C#',''],
            ['d#','','','','','','','','','','','','','','','','d#','','','','','','','','','','','','e','','',''],
            ['D','','','','','','','','','','','','','','','','D','','','','','','','','','','F','','','F','',''],
            ['A','','A','','','A','','G','','G','','','','','','','F','','F','','','G','','A','','','','G','A','','',''],
        ],
    },
    
    
    
    'synth':{
        'boombap': [
            ['e','','','','','','','','','','b','','','','','','e','','','','','','','','','','b','','','','',''],
            ['e','','','','','','','f#','g','','b','','','','','','e','','b','','','','','f#','g','','','','','','',''],
            ['e','','b','','','','f#','g','e','','','','f#','g','f#','g','e','','b','','','','f#','g','e','','','','f#','','f#','g'],
            ['e','','b','','f#','g','f#','g','e','','','','f#','g','f#','g','e','','b','','f#','g','f#','g','e','','','','f#','g','f#','g'],
        ],
        'westcoast': [
            ['Bb','','','','','','','','','','B','','f','','','','Bb','','','','','','','','','','B','','f','','bb',''],
            ['Bb','','','','f#','','','','','','B','','f','','','','Bb','','','','f#','','','','','','B','','f','','bb',''],
            ['Bb','','','','f#','','','','','','B','','f','','bb','','Bb','','d#','','f#','','','','','','B','','f','','bb',''],
            ['Bb','','d#','','f#','','','','','','B','','f','','Bb','','Bb','','d#','','f#','','','f#','','','B','B','f','','bb',''],
        ],
        'trap': [
            ['d','','','','','','eb','','','','','','','','','','d','','','','','','eb','','','','','','eb','','',''],
            ['d','','','','','','eb','','','','','','eb','','','','d','','','','','','eb','','','','','','eb','Ab','','Eb'],
            ['d','','','','','','eb','','','','','','eb','Ab','','Eb','f','','','','','','eb','','','','','','eb','Ab','','Eb'],
            ['d','','','d','','','eb','','','','eb','','Ab','','Eb','','f','','','','','','eb','','','','eb','','eb','Ab','','Eb'],
,
        ],
        'neptunes': [
            ['g#','','g#','','f#','','f#','','e','','','c#','','','c#','c#','c#','c#','c#','','B','','c#','','c#','','','c#','','','B','B'],
            ['d#','','','','g','','e','','d#','','g','','a#','','g','','d#','','','','g','','e','','d#','','e','','g','','a#',''],
            ['d','','a','','a','','d','d','','d','a','','a','','d','d','bb','','bb','','a','','d','bb','','bb','bb','','a','','f',''],
            ['A','A','A','A','','','B','B','B','B','','','','','A','B','c','B','','A','','G','','A','C','','','','G','','G',''],
        ],
    },

}


const t_arr = ['B','','','','','','','','','','','','','','','','B','','','','','','','','','','','','c','','','']
transpose(t_arr, -8)









